# Vibe Trader UI

Русский интерфейс для AI ассистента (React + TypeScript, Vite).

## Возможности
- Тёмная тема по умолчанию (спокойные цвета, минимализм)
- Левая панель с кнопкой «Новый диалог» и списком диалогов
- Одна страница с областью переписки
- Поле ввода снизу, отправка Enter (Shift+Enter — новая строка)
- Разделение сообщений по ролям (Вы / AI агент)
- После отправки сообщения запускается асинхронная задача, статус опрашивается каждые 2 сек
- Плавная анимация «размышления агента» пока ответ готовится

## Стек
- React 18
- TypeScript строго
- Vite

## Структура
- `src/api.ts` — типы и клиент для API бэкенда (`/api/ai`)
- `src/App.tsx` — основной экран приложения (одна страница)
- `src/styles.css` — кастомные CSS-стили (тёмная тема, анимации)

## Установка зависимостей (без сюрпризов)
Требования:
- Node.js 20.19+ или 22.12+ (нужно для Vite 7). Проверить версию: `node -v`.
- npm 10+ (поставляется с Node 20+). Проверить версию: `npm -v`.

Рекомендуемый первый запуск (на чистой машине):

- Windows PowerShell
  ```powershell
  cd .\vibe-trader-ui
  # убедитесь, что Node версии 20.19+ или 22.12+
  node -v
  npm -v
  # чистая установка по lock-файлу
  npm ci
  # запуск дев-сервера
  npm run dev
  ```

- macOS/Linux (bash/zsh)
  ```bash
  cd vibe-trader-ui
  node -v
  npm -v
  npm ci
  npm run dev
  ```

Если `npm ci` не доступна (или lock-файл поменяли вручную), можно использовать установку с пересборкой lock-файла:
```bash
npm install
```

Полная переустановка зависимостей (если что-то «сломалось»):
- Windows PowerShell
  ```powershell
  cd .\vibe-trader-ui
  Remove-Item -Recurse -Force node_modules
  Remove-Item -Force package-lock.json
  npm cache verify
  npm install
  ```
- macOS/Linux
  ```bash
  cd vibe-trader-ui
  rm -rf node_modules package-lock.json
  npm cache verify
  npm install
  ```

Альтернативные менеджеры пакетов (по желанию):
- PNPM (через Corepack)
  ```bash
  corepack enable
  corepack prepare pnpm@latest --activate
  pnpm i
  pnpm dev
  ```
- Yarn (Classic/ Berry)
  ```bash
  corepack enable
  corepack prepare yarn@stable --activate
  yarn install
  yarn dev
  ```

Сборка продакшен-версии:
```bash
npm run build
npm run preview   # локальный предпросмотр сборки
```

Если при `npm run build` видите сообщение о неподдерживаемой версии Node — обновите Node до 20.19+ или 22.12+ (LTS) и повторите.

## Подключение к бэкенду
Фронтенд ожидает доступность следующих эндпоинтов на бэкенде `AiChatController`:
- `GET /api/ai/dialogs` — список диалогов
- `POST /api/ai/dialogs` — создать диалог `{ title }`
- `GET /api/ai/dialogs/{dialogId}/messages` — сообщения диалога
- `POST /api/ai/dialogs/{dialogId}/messages` — отправить сообщение пользователя `{ content }`
  - В ответе вернётся `taskId`, по которому фронтенд опрашивает статус
- `GET /api/ai/tasks/{taskId}` — статус асинхронной задачи (ожидание ответа от агента)

Важно: фронтенд считает, что последнее сообщение пользователя содержит `taskId`, по которому и идёт опрос. Когда задача завершается, мы повторно запрашиваем список сообщений, чтобы показать ответ агента.

## Локальный запуск
1. Установите зависимости (см. раздел выше).
2. Запустите дев-сервер:
   ```bash
   npm run dev
   ```
3. Откройте в браузере адрес, который покажет Vite (обычно http://localhost:5173).

Если вы запускаете фронтенд локально (Vite), в `vite.config.ts` настроен прокси на порт 8080:

```ts
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
      }
    }
  }
})
```
Это означает, что запросы к `/api/**` во время разработки автоматически отправляются на `http://localhost:8080`. В продакшене предполагается, что фронтенд раздаётся за тем же доменом/прокси, и путь `/api/ai` доступен без изменения кода.

Если фронтенд и бэкенд запускаются в Docker Compose — убедитесь, что прокси/ингресс корректно прокидывает `/api/ai` на сервис бэкенда.

## Настройка темы
По умолчанию активна тёмная тема. В файле `src/styles.css` можно настраивать цветовые переменные:
```css
:root {
  --bg: #0f1115;
  --bg-elev: #151821;
  --text: #e6e8ef;
  --muted: #9aa4b2;
  --primary: #7aa2f7;
  --accent: #a6da95;
  --danger: #ff6b6b;
  --border: #252a36;
}
```

## UX детали
- Отправка по Enter; Shift+Enter добавляет новую строку
- Ошибки выводятся неблокирующим тостом справа внизу (клик по нему — закрытие)
- При выборе существующего диалога фронтенд автоматически проверяет, не ожидается ли ответ агента по последнему сообщению

## Лицензия
Часть общего проекта Vibe Trader. Используйте в соответствии с лицензией корневого репозитория.
